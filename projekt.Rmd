---
title: "Poročilo pri predmetu Analiza podatkov s programom R"
author: "Tjaša Trafela"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
runtime: shiny
---

```{r setup, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding="UTF-8")
```

```{r rstudio, results='asis'}
# Izris povezave do RStudia na Binderju
source("lib/rstudio.r", encoding="UTF-8")
```

# Količine pridelanih kmetijskih pridelkov in število živine v Sloveniji

Izbrala sem si temo z naslovom Količine pridelanih kmetijskih pridelkov in število živine v Sloveniji. Prikazala bom, kako so se količine kmetijskih pridelkov spreminjale v časovnem obdobju od leta 2010 do 2019, količino posameznega pridelka v Sloveniji ter količina kmetijskih pridelkov po regijah. Prav tako bom prikazala število in vrsto živine po regijah. Podatke bom iskala na Statističnem uradu Republike Slovenije.

![](slike/grb.png)

***

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz}
source("uvoz/Uvoz1.r", encoding="UTF-8")
```

Uvozila sem podatke o količini kmetijskih pridelkoh po regijah v obliki CSV s statističnega urada.
Podatke imam v dveh razpredelnicah v obliki *tidy data*.

1. `kmetijska.kultura` - podatki o kmetijskih kulturah
  - `leto` - spremenljivka: leto od 2010 do 2019 (tip podatkov: 
                celo število)
  - `regija` - spremenljivka: slovenska regija (tip: niz)
  - `kolicina` - meritev: povprečna količina pridelanega  
        pridelka v t/ha v ustreznem letu in ustrezni regiji
          (tip:realno število)
  
2. `vrsta.zivine` - podatki o živini
  - `leto` - spremenljivka: leta  2003, 2005, 2007, 2009,
        2011,2013,2015,2017,2019  (tip podatkov: celo število)
  - `regija` - spremenljivka: slovenska regija (tip: niz)
  - `stevilo` - meritev: stevilo  glav živine v danem letu in
        dani regiji   (tip: realno število)



**Opomba**:  da je 1. razpredelnica res v obliki *tidy data*, sem morala podati znak, ki označuje manjkajoče podatke("-"), imena regij in leta sem spravila v stolpec in nato preimenovala naslove stolpcev, ki so bili sestavljeni iz več besed. Leta sem pretvorila v cela števila.
v 2. razpredelnici sem podala znak, ki označuje manjkajoče podatke ('N', 'Z'), leta in števila živali sem spravila v stolpec in stolpce preimenovala. Leta sem pretvorila v cela števila.



Spodnja grafa prikazujeta povprečje kmetijskih kultur (v t/ha) in živine (v številu glav) skozi leta in po regijah, torej prikaže, katera kultura in katera vrsta živine je v povprečju najpogostejša v Sloveniji skozi vsa ta leta. 


```{r histogram, fig.align='center', fig.cap='Histogram kmetijskih kultur v Sloveniji'}
 ggplot(aes(x = kmetijska.kultura, y = povprecje, group=1), 
         data = povprecje.pridelkov.slovenija) + geom_col() + coord_flip() + 
  ggtitle("Povprečje kmetijskih kultur") 
```

```{r histogram, fig.align='center', fig.cap='Histogram živine v Sloveniji'}
 ggplot(aes(x = vrsta.zivine, y = povprecje, group=1), 
                      data = povprecje.zivine.slovenija) + geom_col() + ggtitle("Povprečje živine")
```


***

# Analiza in vizualizacija podatkov

```{r vizualizacija, results='hide'}
source("vizualizacija/vizualizacija.r", encoding="UTF-8")
```

Spodnji zemljevid prikazuje povprečno velikost družine za vsako občino.

```{r zemljevid, fig.align='center', fig.cap='Zemljevid povprečne razširjenosti kmetijskih izdelkov po regijah'}
tm_shape(merge(zemljevid, najvec.pridelkov.regije, by.x="NAME_1", by.y="regija")) +
  tm_polygons("povprecje", title="Povprečje") +
  tm_layout(title="Povprečna razširjenost kmetijskih izdelkov po regijah")
```

```{r zemljevid, fig.align='center', fig.cap='Zemljevid povprečne razširjenosti živinorejskih izdelkov po regijah'}
tm_shape(merge(zemljevid, najvec.zivine.regije, by.x="NAME_1", by.y="regija" )) +     tm_polygons("povprecje",title="Povprečje") +
   tm_layout(title="Povprečna razširjenost živinorejskih pridelkov")


```

***

# Napredna analiza podatkov

```{r analiza}
source("analiza/analiza.r", encoding="UTF-8")
```

Spodnji graf prikazuje povezavo med številom naselij in površino občine.

```{r graf, fig.align='center', fig.cap='Povezava med številom naselij in površino občine'}
ggplot(inner_join(obcine, data.frame(obcina=names(skupine),
                                     skupina=factor(skupine)), by="obcina")
, aes(x=povrsina, y=naselja, color=skupina, size=prebivalci/1000)) + geom_point() +
  ggtitle("Število naselij glede na površino občine") +
  xlab(expression("Površina (km"^2 * ")")) + ylab("Št. naselij") +
  guides(color=guide_legend(title="Skupina"),
         size=guide_legend(title="Prebivalci (* 1000)"))
```

***

```{r shiny}
shinyAppDir("shiny", options=list(width="100%", height=600))
```
